["{\"nodes\":{\"Compute_Gift_Categories\":{\"action\":\"computeExpression\",\"parameters\":{\"computedFields\":[{\"label\":\"GiftRange\",\"name\":\"GiftRange\",\"saqlExpression\":\"case when 'DonationInYear' >= 5000 then \\\"$5,000 & up\\\" when 'DonationInYear' >= 1000 then \\\"$1,000 to $4,999\\\" when 'DonationInYear' >= 250 then \\\"$250 to $999\\\" when 'DonationInYear' >= 100 then \\\"$100 to $249\\\" else \\\"Under $100\\\" end\",\"type\":\"Text\"},{\"label\":\"LapsedDonors\",\"name\":\"LapsedDonors\",\"saqlExpression\":\"case when 'DonationNextYear' == \\\"No\\\" and 'DonorType' == \\\"New\\\" then \\\"Lapsed New\\\" when 'DonationNextYear' == \\\"No\\\" and PrevYear <= 'FiscalYear' - 1 then \\\"Lapsed Repeat\\\" else \\\"N/A\\\" end\",\"type\":\"Text\"}],\"mergeWithSource\":true},\"sources\":[\"Compute_DonationChange\"]},\"register_YearDonations\":{\"action\":\"register\",\"parameters\":{\"label\":\"YearDonations\",\"name\":\"YearDonations\"},\"sources\":[\"Convert_LapsedYear\"]},\"Extract_Donation\":{\"action\":\"sobjectDigest\",\"parameters\":{\"fields\":[{\"name\":\"Id\"},{\"name\":\"AccountId\"},{\"name\":\"OwnerId\"},{\"name\":\"Name\"},{\"name\":\"IsWon\"},{\"name\":\"IsClosed\"},{\"name\":\"CreatedDate\"},{\"firstDayOfWeek\":1,\"fiscalMonthOffset\":0,\"name\":\"CloseDate\"},{\"name\":\"Amount\"},{\"name\":\"FiscalYear\"}],\"object\":\"Opportunity\",\"passthroughFilter\":\"IsWon = true\",\"runtime\":{\"SFDCtoken\":\"SFDCtoken\"}}},\"Compute_CurrentYear\":{\"action\":\"computeExpression\",\"parameters\":{\"computedFields\":[{\"firstDayOfWeek\":1,\"fiscalMonthOffset\":0,\"format\":\"yyyy-MM-dd\",\"isYearEndFiscalYear\":false,\"label\":\"CurrentYear\",\"name\":\"CurrentYear\",\"saqlExpression\":\"now()\",\"type\":\"Date\"}],\"mergeWithSource\":true},\"sources\":[\"Compute_2YearsAgo\"]},\"Join_Donation_Account\":{\"action\":\"augment\",\"parameters\":{\"leftKey\":[\"AccountId\"],\"relationship\":\"Account\",\"rightKey\":[\"Id\"],\"rightSelect\":[\"Name\",\"OwnerId\",\"BillingCountry\",\"BillingState\",\"CreatedDate\"]},\"sources\":[\"Extract_Donation\",\"Extract_Account\"]},\"Compute_LapsedYear\":{\"action\":\"computeExpression\",\"parameters\":{\"computedFields\":[{\"label\":\"LapsedYear_Number\",\"name\":\"LapsedYear_Number\",\"precision\":12,\"saqlExpression\":\"case when 'LapsedDonors' != \\\"N/A\\\" then 'FiscalYear' + 1 else 'FiscalYear' end\",\"scale\":0,\"type\":\"Numeric\"}],\"mergeWithSource\":true},\"sources\":[\"Compute_Gift_Categories\"]},\"Convert_LapsedYear\":{\"action\":\"computeExpression\",\"parameters\":{\"computedFields\":[{\"label\":\"LapsedYear\",\"name\":\"LapsedYear\",\"saqlExpression\":\"number_to_string('LapsedYear_Number', \\\"####\\\")\",\"type\":\"Text\"}],\"mergeWithSource\":true},\"sources\":[\"Compute_LapsedYear\"]},\"Extract_Account\":{\"action\":\"sobjectDigest\",\"parameters\":{\"fields\":[{\"name\":\"Id\"},{\"name\":\"Name\"},{\"name\":\"OwnerId\"},{\"name\":\"BillingCountry\"},{\"name\":\"BillingState\"},{\"name\":\"CreatedDate\"}],\"object\":\"Account\",\"runtime\":{\"SFDCtoken\":\"SFDCtoken\"}}},\"Compute_Aggregated_Amount\":{\"action\":\"computeRelative\",\"parameters\":{\"computedFields\":[{\"expression\":{\"saqlExpression\":\"case when 'FiscalYear' == next('FiscalYear') && next('DonationInYear') > 'DonationInYear' then \\\"false\\\" else \\\"true\\\" end\",\"type\":\"Text\"},\"label\":\"HighestAmountInYear\",\"name\":\"HighestAmountInYear\"}],\"orderBy\":[{\"direction\":\"asc\",\"name\":\"FiscalYear\"}],\"partitionBy\":[\"AccountId\"]},\"sources\":[\"Compute_Amount_per_Year\"]},\"Extract_User\":{\"action\":\"sobjectDigest\",\"parameters\":{\"fields\":[{\"name\":\"Id\"},{\"name\":\"FirstName\"},{\"name\":\"LastName\"},{\"name\":\"Name\"},{\"name\":\"Username\"},{\"name\":\"SmallPhotoUrl\"}],\"object\":\"User\"}},\"Compute_PrevYear\":{\"action\":\"computeRelative\",\"parameters\":{\"computedFields\":[{\"description\":\"PreviousDonationYear\",\"expression\":{\"default\":\"0\",\"saqlExpression\":\"case when 'FiscalYear' != previous('FiscalYear') then previous('FiscalYear') else previous('PrevYear') end\",\"type\":\"Numeric\"},\"label\":\"PrevYear\",\"name\":\"PrevYear\"}],\"orderBy\":[{\"direction\":\"asc\",\"name\":\"FiscalYear\"}],\"partitionBy\":[\"AccountId\"]},\"sources\":[\"Join_Donation_User\"]},\"Join_Donation_User\":{\"action\":\"augment\",\"parameters\":{\"leftKey\":[\"Account.OwnerId\"],\"operation\":\"LookupSingleValue\",\"relationship\":\"User\",\"rightKey\":[\"Id\"],\"rightSelect\":[\"FirstName\",\"LastName\",\"Name\",\"SmallPhotoUrl\",\"Username\"]},\"sources\":[\"Join_Donation_Account\",\"Extract_User\"]},\"Convert_FiscalYear\":{\"action\":\"computeExpression\",\"parameters\":{\"computedFields\":[{\"label\":\"FiscalYear_String\",\"name\":\"FiscalYear_String\",\"saqlExpression\":\"number_to_string('FiscalYear', \\\"####\\\")\",\"type\":\"Text\"},{\"defaultValue\":\"0\",\"label\":\"CurrentYear_Number\",\"name\":\"CurrentYear_Number\",\"precision\":8,\"saqlExpression\":\"string_to_number('CurrentYear_Year' )\",\"scale\":2,\"type\":\"Numeric\"}],\"mergeWithSource\":true},\"sources\":[\"Compute_CurrentYear\"]},\"register_Donations\":{\"action\":\"register\",\"parameters\":{\"label\":\"Donations\",\"name\":\"Donations\"},\"sources\":[\"Convert_FiscalYear\"]},\"Compute_DonationChange\":{\"action\":\"computeRelative\",\"parameters\":{\"computedFields\":[{\"expression\":{\"saqlExpression\":\"case when PrevYear == 0 and Prev2Years == 0 then \\\"New\\\" when FiscalYear -1 != PrevYear and PrevYear != 0 then \\\"Recaptured\\\" when FiscalYear - 1 == PrevYear && DonationInYear == previous(DonationInYear) then \\\"Same\\\" when FiscalYear - 1 == PrevYear && DonationInYear > previous(DonationInYear) then \\\"Upgraded\\\" when FiscalYear - 1 == PrevYear && DonationInYear < previous(DonationInYear) then \\\"Downgraded\\\" else \\\"N/A\\\" end\",\"type\":\"Text\"},\"label\":\"DonorType\",\"name\":\"DonorType\"},{\"expression\":{\"saqlExpression\":\"case when 'FiscalYear' - 1 == 'PrevYear' then 'DonationInYear' - previous('DonationInYear') else 0 end\",\"type\":\"Numeric\",\"scale\":2},\"label\":\"DonationChange\",\"name\":\"DonationChange\"},{\"expression\":{\"saqlExpression\":\"case when next('FiscalYear') == 'FiscalYear' + 1 or next('FiscalYear') == 'CurrentYear_Number'  or 'FiscalYear' == 'CurrentYear_Number' then \\\"Yes\\\" else \\\"No\\\" end\",\"type\":\"Text\"},\"label\":\"DonationNextYear\",\"name\":\"DonationNextYear\"}],\"orderBy\":[{\"direction\":\"asc\",\"name\":\"FiscalYear\"}],\"partitionBy\":[\"AccountId\"]},\"sources\":[\"Filter_TotalAmount\"]},\"Filter_TotalAmount\":{\"action\":\"filter\",\"parameters\":{\"filter\":\"HighestAmountInYear:EQ:true\"},\"sources\":[\"Compute_Aggregated_Amount\"]},\"Compute_2YearsAgo\":{\"action\":\"computeRelative\",\"parameters\":{\"computedFields\":[{\"description\":\"Previous 2 Years\",\"expression\":{\"default\":\"0\",\"saqlExpression\":\"case when 'PrevYear' != previous('PrevYear') then previous('PrevYear') else previous('Prev2Years') end\",\"type\":\"Numeric\"},\"label\":\"Prev2Years\",\"name\":\"Prev2Years\"}],\"orderBy\":[{\"direction\":\"asc\",\"name\":\"FiscalYear\"}],\"partitionBy\":[\"AccountId\"]},\"sources\":[\"Compute_PrevYear\"]},\"Compute_Amount_per_Year\":{\"action\":\"computeRelative\",\"parameters\":{\"computedFields\":[{\"expression\":{\"default\":\"null\",\"saqlExpression\":\"case when 'FiscalYear' == previous('FiscalYear') then previous('DonationInYear') + 'Amount' else 'Amount' end\",\"type\":\"Numeric\",\"scale\":2},\"label\":\"DonationInYear\",\"name\":\"DonationInYear\"}],\"orderBy\":[{\"direction\":\"asc\",\"name\":\"FiscalYear\"}],\"partitionBy\":[\"AccountId\"]},\"sources\":[\"Convert_FiscalYear\"]}}}",null]